<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>AI Voice Diary</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
<div class="app-root">
    <header class="app-header">
        <div class="app-title">AI Voice Diary</div>
        <div class="user-row">
            <div class="app-user">Hi, {{ username }} !</div>
        </div>
    </header>

    <main class="app-main">
        <!-- Chat / recording -->
        <section class="page-section" id="section-chat">
            <button id="start-conversation-btn">Start a New Conversation</button>
            <div class="chat-layout">
                <div class="chat-left full-width">
                    <h3>Today's Conversation</h3>
                    <div id="conversation" class="conversation-box"></div>

                    <div class="record-controls">
                        <button id="start-recording-btn" disabled>üéô Start</button>
                        <button id="stop-recording-btn" disabled>‚èπ Stop</button>
                        <button id="open-preferences-btn" disabled>‚öô Diary Settings</button>
                        <button id="finish-conversation-btn" disabled>Finish &amp; Generate Diary</button>
                    </div>

                    <div id="conversation-status" class="status-text">
                        Ready.
                    </div>
                </div>

                <div class="chat-right hidden" id="diary-edit-box">
                    <h4>Edit Your Diary</h4>
                    
                    <div class="edit-group">
                        <label for="edit-diary-date">Date (what day is this diary about?)</label>
                        <input type="date" id="edit-diary-date" class="edit-input">
                    </div>

                    <div class="edit-group">
                        <label for="edit-diary-title">Title</label>
                        <input type="text" id="edit-diary-title" class="edit-input" placeholder="Enter diary title...">
                    </div>

                    <div class="edit-group">
                        <label for="edit-diary-mood">Mood</label>
                        <select id="edit-diary-mood" class="edit-select">
                            <option value="positive">üòÑ Positive</option>
                            <option value="neutral">üòê Neutral</option>
                            <option value="negative">üòî Negative</option>
                        </select>
                    </div>

                    <div class="edit-group">
                        <label for="edit-diary-content">Content</label>
                        <textarea id="edit-diary-content" class="edit-textarea" rows="8" placeholder="Your diary content..."></textarea>
                    </div>

                    <div class="regenerate-section">
                        <label for="regenerate-instructions">Want changes? Add instructions and regenerate:</label>
                        <input type="text" id="regenerate-instructions" class="edit-input" placeholder="e.g., Make it more reflective...">
                        <button id="regenerate-btn" class="secondary-btn">üîÑ Regenerate</button>
                    </div>

                    <div class="diary-edit-actions">
                        <button id="discard-diary-btn" class="secondary-btn">Discard</button>
                        <button id="save-diary-btn" class="primary-btn">üíæ Save Diary</button>
                    </div>
                </div>
            </div>
        </section>


        <!-- Diary Preferences Modal -->
        <div id="preferences-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Diary Generation Settings</h3>
                    <button id="close-preferences-btn" class="close-btn">&times;</button>
                </div>
                
                <div class="modal-body">
                    <!-- Theme Selection -->
                    <div class="preference-group">
                        <label>Theme / Topic Focus</label>
                        <select id="diary-theme">
                            <option value="">-- Auto detect --</option>
                            <option value="daily life">Daily Life</option>
                            <option value="work">Work & Career</option>
                            <option value="travel">Travel & Adventure</option>
                            <option value="relationships">Relationships & Social</option>
                            <option value="health">Health & Wellness</option>
                            <option value="personal growth">Personal Growth</option>
                            <option value="hobbies">Hobbies & Interests</option>
                            <option value="gratitude">Gratitude & Appreciation</option>
                        </select>
                    </div>

                    <!-- Style Selection -->
                    <div class="preference-group">
                        <label>Writing Style</label>
                        <select id="diary-style">
                            <option value="">-- Default --</option>
                            <option value="reflective">Reflective & Thoughtful</option>
                            <option value="humorous">Light & Humorous</option>
                            <option value="poetic">Poetic & Descriptive</option>
                            <option value="professional">Professional & Structured</option>
                            <option value="casual">Casual & Friendly</option>
                            <option value="motivational">Motivational & Inspiring</option>
                        </select>
                    </div>

                    <!-- Custom Instructions -->
                    <div class="preference-group">
                        <label>Custom Instructions (optional)</label>
                        <div class="custom-input-container">
                            <textarea 
                                id="custom-instructions" 
                                placeholder="Add any specific requests... e.g., 'Focus on my feelings about the new project' or 'Include lessons learned'"
                                rows="3"
                            ></textarea>
                            <div class="voice-input-controls">
                                <button id="start-voice-input-btn" class="voice-btn" title="Voice input">üé§</button>
                                <button id="stop-voice-input-btn" class="voice-btn hidden" title="Stop recording">‚èπ</button>
                                <span id="voice-input-status"></span>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Templates -->
                    <div class="preference-group">
                        <label>Quick Templates</label>
                        <div class="template-buttons">
                            <button class="template-btn" data-template="Focus on the emotions and feelings I expressed">Emotional Focus</button>
                            <button class="template-btn" data-template="Include actionable takeaways and next steps">Action Items</button>
                            <button class="template-btn" data-template="Write as if I'm looking back on this day years from now">Future Reflection</button>
                            <button class="template-btn" data-template="Keep it brief and highlight only the key moments">Brief Summary</button>
                        </div>
                    </div>
                </div>

                <div class="modal-footer">
                    <button id="reset-preferences-btn" class="secondary-btn">Reset</button>
                    <button id="save-preferences-btn" class="primary-btn">Save & Close</button>
                </div>
            </div>
        </div>
        
        <!-- My diaries -->
        <section class="page-section hidden" id="section-diaries">
            <h3>My Diaries</h3>

            <div class="diary-search">
                <input id="diary-search-input" placeholder="Search by keyword..." />
                <button id="diary-search-btn">Search</button>
                <button id="diary-search-clear-btn">Clear</button>
                <button id="load-diaries-btn">Reload</button>
            </div>

            <!-- Calendar View -->
            <div class="calendar-container">
                <div class="calendar-nav">
                    <button id="prev-month-btn">‚óÄ</button>
                    <span id="calendar-title">December 2025</span>
                    <button id="next-month-btn">‚ñ∂</button>
                    <button id="today-btn">Today</button>
                </div>
                <div id="calendar-grid" class="calendar-grid"></div>
            </div>

            <!-- Diaries for selected date -->
            <div class="calendar-diary-section">
                <h4>Diaries for Selected Date</h4>
                <ul id="calendar-diary-list"></ul>
            </div>

            <hr class="section-divider">

            <div class="diary-layout">
                <ul id="diary-list"></ul>

                <article id="diary-detail" class="diary-detail">
                    <h4 id="diary-title"></h4>
                    <p id="diary-entry-date" class="diary-entry-date"></p>
                    <p id="diary-created-info" class="diary-created-info"></p>
                    <p id="diary-mood"></p>
                    <p id="diary-content"></p>

                    <div class="diary-actions hidden">
                        <button id="diary-edit-btn">Edit</button>
                        <button id="diary-delete-btn">Delete</button>
                    </div>
                </article>
            </div>
        </section>

        <!-- Settings -->
        <section class="page-section hidden" id="section-settings">
            <h3>Settings</h3>
            <p>Logged in as: {{ username }}</p>
            <button onclick="logout()">Logout</button>
        </section>
    </main>

    <nav class="bottom-nav">
        <button class="nav-btn active" data-target="section-chat">Chat</button>
        <button class="nav-btn" data-target="section-diaries">My Diaries</button>
        <button class="nav-btn" data-target="section-settings">Settings</button>
    </nav>
</div>

<script>
    const currentUserId = "{{ user_id }}";
</script>
<script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>